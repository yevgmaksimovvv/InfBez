# Теория сложности генерации простых чисел для RSA

## Почему генерация простых чисел занимает много времени?

### 1. Плотность простых чисел (Prime Number Theorem)

**Теорема о распределении простых чисел** утверждает, что количество простых чисел, не превышающих N, приблизительно равно:

```
π(N) ≈ N / ln(N)
```

где `ln(N)` — натуральный логарифм.

**Практический вывод:**
- Для числа из `n` бит (диапазон примерно `2^n`), вероятность того, что случайное число является простым, составляет примерно:
  
  ```
  P(простое) ≈ 1 / ln(2^n) = 1 / (n × ln(2)) ≈ 1 / (0.693 × n)
  ```

### 2. Вероятность для чисел разной длины

| Длина числа | Диапазон | Вероятность простого | Ожидаемое количество попыток |
|-------------|----------|---------------------|------------------------------|
| 256 бит     | ~10^77   | ≈ 1/177            | ~177 попыток                |
| 512 бит     | ~10^154  | ≈ 1/354            | ~354 попытки                |
| 1024 бит    | ~10^308  | ≈ 1/708            | ~708 попыток                |
| **16384 бит** | ~10^4933 | **≈ 1/11356**      | **~11,356 попыток**         |
| 32768 бит   | ~10^9866 | ≈ 1/22713          | ~22,713 попыток             |

### 3. Сложность проверки на простоту

#### Проверка простоты — это вычислительно дорогая операция

Для больших чисел используются вероятностные тесты (например, **тест Миллера-Рабина**), которые:

1. **Быстрые**: выполняются за полиномиальное время O(k × log³(n)), где k — количество раундов
2. **Но всё равно медленные для огромных чисел**: 
   - Для 16384-битного числа операции выполняются с числами длиной ~2000 байт
   - Каждая операция возведения в степень по модулю требует тысяч арифметических операций

#### Пример сложности теста Миллера-Рабина:

- **256 бит**: ~1-10 миллисекунд на проверку
- **512 бит**: ~10-100 миллисекунд
- **1024 бит**: ~100-1000 миллисекунд (0.1-1 секунда)
- **16384 бит**: **~10-100 секунд на проверку** ⚠️

### 4. Общее время генерации

Для генерации **одного** простого числа длиной 16384 бит:

```
Время = (Количество попыток) × (Время проверки на простоту)

Время ≈ 11,356 попыток × 50 секунд = ~568,000 секунд = ~6.6 дней
```

**НО!** На практике используется оптимизация:

1. **Предварительная фильтрация**: отбрасываем числа, делящиеся на маленькие простые (2, 3, 5, 7, ...)
2. **Быстрые тесты**: сначала быстрые проверки, потом детальная проверка
3. **Оптимизированные алгоритмы**: GMP использует очень эффективные реализации

**Реальное время**: ~1-10 минут на одно 16384-битное простое число (на современном процессоре)

### 5. Почему для RSA нужно два простых числа?

**Итого время генерации ключей RSA-32768:**

```
Время = Время генерации p + Время генерации q

Без параллелизации: ~2-20 минут
С параллелизацией:  ~1-10 минут (≈ 2x ускорение)
```

### 6. Математическая сложность

#### Асимптотическая сложность:

- **Генерация случайного числа**: O(n), где n — длина в битах
- **Проверка на простоту** (тест Миллера-Рабина): O(k × log³(n))
- **Ожидаемое количество попыток**: O(n × ln(2))

**Общая сложность генерации одного простого числа:**

```
O(n × k × log³(n))
```

где:
- `n` — длина числа в битах (16384)
- `k` — количество раундов теста (обычно 10-20)

**Для n = 16384:**
- Это очень большая константа, поэтому и занимает много времени!

### 7. Почему нельзя использовать меньшие простые?

**Безопасность RSA основана на сложности факторизации:**

- Факторизация `n = p × q` должна быть вычислительно невозможной
- Самые быстрые известные алгоритмы факторизации:
  - **Общий решётчатый метод**: O(e^(1.9 × (ln n)^(1/3) × (ln ln n)^(2/3)))
  - Для 1024 бит: ~10^80 операций (невозможно сейчас)
  - Для 2048 бит: ~10^120 операций (безопасно на 20-30 лет)
  - **Для 32768 бит**: ~10^300+ операций (безопасно на десятилетия)

### 8. Практические числа

**Реальное время генерации на современном процессоре (2024):**

| Длина ключа | Длина простого | Время генерации одного простого | Общее время (p+q) |
|-------------|----------------|--------------------------------|-------------------|
| 2048 бит    | 1024 бит       | ~5-30 секунд                   | ~10-60 секунд     |
| 4096 бит    | 2048 бит       | ~30-300 секунд                 | ~1-10 минут       |
| **8192 бит**| **4096 бит**   | **~2-20 минут**                | **~4-40 минут**   |
| **32768 бит**| **16384 бит** | **~5-60 минут**                | **~5-60 минут**   |

### 9. Оптимизации в GMP

Библиотека GMP использует:

1. **Ассемблерные оптимизации** для базовых операций
2. **Быстрый метод Карацубы** для умножения больших чисел
3. **Оптимизированный тест Миллера-Рабина** с предварительной фильтрацией
4. **Кэширование** малых простых чисел
5. **Параллелизация** отдельных операций

Но даже с этими оптимизациями генерация огромных простых чисел остается очень медленной!

### 10. Вывод

**Почему генерация занимает много времени:**

1. ✅ **Низкая плотность простых чисел**: нужно проверить ~11,000 чисел
2. ✅ **Медленная проверка на простоту**: каждая проверка занимает секунды
3. ✅ **Огромные числа**: операции с 16384-битными числами очень медленные
4. ✅ **Высокие требования безопасности**: нужно гарантировать простоту

**Это цена безопасности RSA!** Чем больше ключ, тем безопаснее, но тем дольше генерация.

